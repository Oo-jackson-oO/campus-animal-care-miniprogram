<view class="container" wx:if="{{!loading}}">
  <!-- å•†å“å›¾ç‰‡è½®æ’­ -->
  <view class="product-images">
    <swiper class="image-swiper" indicator-dots="false" autoplay="false" circular="true" bindchange="onSwiperChange">
      <swiper-item wx:for="{{product.images}}" wx:key="index" bindtap="previewImage" data-index="{{index}}">
        <image src="{{item}}" mode="aspectFill" class="product-image" lazy-load="true"></image>
      </swiper-item>
    </swiper>
    
    <!-- å›¾ç‰‡æŒ‡ç¤ºå™¨ -->
    <view class="image-indicators" wx:if="{{product && product.images && product.images.length > 1}}">
      <view 
        class="indicator {{currentImageIndex === index ? 'active' : ''}}"
        wx:for="{{product.images}}" 
        wx:key="index"
        bindtap="onImageChange"
        data-index="{{index}}"
      ></view>
    </view>
  </view>

  <!-- å•†å“åŸºæœ¬ä¿¡æ¯ -->
  <view class="product-info">
    <view class="price-section">
      <text class="current-price">Â¥{{product.price}}</text>
      <text class="original-price" wx:if="{{product.originalPrice > product.price}}">Â¥{{product.originalPrice}}</text>
    </view>
    
    <view class="title">{{product.name}}</view>
    
    <view class="meta-info">
      <view class="rating">
        <text class="stars">â˜…â˜…â˜…â˜…â˜…</text>
        <text class="rating-text">{{product.rating}}åˆ†</text>
        <text class="review-count">({{product.reviewCount}}æ¡è¯„ä»·)</text>
      </view>
      <view class="sales">å·²å”®{{product.sales}}ä»¶</view>
    </view>
    
    <view class="description">{{product.description}}</view>
  </view>

  <!-- å•†å“ç‰¹è‰² -->
  <view class="features-section">
    <section-title title="å•†å“ç‰¹è‰²"></section-title>
    <view class="features-list">
      <view class="feature-item" wx:for="{{product.features}}" wx:key="index">
        <text class="feature-icon">âœ“</text>
        <text class="feature-text">{{item}}</text>
      </view>
    </view>
  </view>

  <!-- å•†å“è¯¦æƒ… -->
  <view class="details-section">
    <section-title title="å•†å“è¯¦æƒ…"></section-title>
    <view class="details-content">
      <text class="details-text">{{product.details}}</text>
    </view>
  </view>

  <!-- ç”¨æˆ·è¯„ä»· -->
  <view class="reviews-section">
    <section-title title="ç”¨æˆ·è¯„ä»·" rightText="{{reviewCountText}}"></section-title>
    
    <view class="reviews-list" wx:if="{{reviews.length > 0}}">
      <view class="review-item" wx:for="{{reviews}}" wx:key="id">
        <view class="review-header">
          <image src="{{item.avatar}}" class="user-avatar" lazy-load="true"></image>
          <view class="user-info">
            <text class="user-name">{{item.userName}}</text>
            <view class="review-rating">
              <text class="stars">{{item.rating}}åˆ†</text>
            </view>
          </view>
          <text class="review-time">{{item.createTime}}</text>
        </view>
        <view class="review-content">{{item.content}}</view>
        <view class="review-images" wx:if="{{item.images.length > 0}}">
          <image 
            src="{{img}}" 
            class="review-image" 
            wx:for="{{item.images}}" 
            wx:key="*this"
            bindtap="previewReviewImage"
            data-current="{{img}}"
            data-urls="{{item.images}}"
            lazy-load="true"
          ></image>
        </view>
        <view class="review-footer">
          <text class="like-count">ğŸ‘ {{item.likes}}</text>
        </view>
      </view>
    </view>
    
    <empty-state wx:else text="æš‚æ— è¯„ä»·" subtext="æœŸå¾…ä½ çš„ç¬¬ä¸€æ¡åé¦ˆ"></empty-state>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="bottom-bar">
    <view class="quantity-section">
      <text class="quantity-label">æ•°é‡ï¼š</text>
      <view class="quantity-controls">
        <button class="quantity-btn" bindtap="decreaseQuantity" disabled="{{quantity <= 1}}">-</button>
        <input 
          class="quantity-input" 
          type="number" 
          value="{{quantity}}" 
          bindinput="onQuantityInput"
          max="{{product.stock}}"
        />
        <button class="quantity-btn" bindtap="increaseQuantity" disabled="{{quantity >= product.stock}}">+</button>
      </view>
    </view>
    
    <view class="action-buttons">
      <button class="add-cart-btn" bindtap="addToCart">åŠ å…¥è´­ç‰©è½¦</button>
      <button class="buy-now-btn" bindtap="buyNow">ç«‹å³è´­ä¹°</button>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-container" wx:if="{{loading}}">
  <skeleton rows="4"></skeleton>
  <skeleton rows="4"></skeleton>
</view>
